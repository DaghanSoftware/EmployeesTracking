@model EmployeesTracking.Models.PersonelViewModel
@{
    ViewData["Title"] = "PersonelListele";
}

@if (TempData["Message"] != null)
{
    @section message
            {
        @await Html.PartialAsync("_message", (string)TempData["Message"])
    }
}

<!doctype html>
<html>

<head>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>
<body>

    <div class="row">
        <div class="col-md-2">

            <div class="modal-dialog">
                <div class="modal-content">
                    <div style="text-align:center">
                        <button type="button" class="btn btn-info" id="btnPersonelEkle">Personel Ekle</button>
                    </div>

                    <div class="modal-header">
                        <h3 class="modal-title">Kriterlere Göre Filtreleme</h3>
                    </div>

                    <form asp-controller="Home" asp-action="Index" method="get">
                        <center>

                            <input class="form-control me-2" id="personeladi" name="q" type="text" placeholder="Personel Ara" aria-label="Ara">
                            <br />
                            <select asp-items="@ViewBag.Cities" id="sehir2" name="sehir" class="form-control">
                                <option selected disabled>Şehir Seçiniz</option>

                            </select>
                            <br />
                            <div class="btn-group" role="group" aria-label="Basic radio toggle button group">
                                <input type="radio" class="btn-check" name="gendernumber" id="btnradio1" value="1" autocomplete="off">
                                <label class="btn btn-outline-primary" for="btnradio1">Erkek</label>

                                <input type="radio" class="btn-check" name="gendernumber" id="btnradio2" value="2" autocomplete="off">
                                <label class="btn btn-outline-primary" for="btnradio2">Kadın</label>
                            </div>
                            <br />
                            <hr />

                            <input type="radio" class="btn-check" name="maritalnumber" id="vbtn-radio1" value="1" autocomplete="off">
                            <label class="btn btn-outline-danger" for="vbtn-radio1">Evli</label>

                            <input type="radio" class="btn-check" name="maritalnumber" id="vbtn-radio2" value="2" autocomplete="off">
                            <label class="btn btn-outline-danger" for="vbtn-radio2">Bekar</label>
                            <br />
                            <hr />
                            <label for="vbtn-radio2">Başlama Tarihi</label>
                            <input class="form-control me-2" id="tarih" type="date" placeholder="Personel Ara" aria-label="Ara">
                            <div style="text-align:center">
                                <button  class="btn btn-outline-primary" onclick="PersonelListesiniIndır()"> Excel Listesini İndir </button>
                            </div>


                            <div class="modal-footer">
                                <div style="text-align:center">
                                    <button type="button" id="btnPersonelleriGetir" class="btn btn-outline-primary"> Filterlenen Personeli Getirme Listesi </button>
                                </div>

                            </div>
                        </center>
                    </form>
                </div>
            </div>
        </div>
        <div class="col-md-10">
            <div id="divPersoneller">
            </div>
        </div>
    </div>

    <div id="divPartial"></div>

</body>
</html>



<script>
    $(document).ready(function () {
        PersonelleriListele();
    });

    $("#btnPersonelleriGetir").click(function () {
        PersonelleriListele();
    });

    function PersonelleriListele() {

        let filtreler = {
            q: $("#personeladi").val(),
            gendernumber: $("input[name='gendernumber']:checked").val(),
            maritalnumber: $("input[name='maritalnumber']:checked").val(),
            sehir: $('#sehir2').val(),
        };
        $("#divPersoneller").load("/Home/PersonelListesiPartial", filtreler);
    }


    $("#btnPersonelEkle").click(function ()
    {
        PersonelDetay(0);
    });

    function PersonelDetay(personelId) {
        $.ajax({
            url: '/Home/PersonelPartial',
            data: {
                id: personelId
            },
            type: 'GET',
            success: function (response) {
                $('#divPartial').html(response);
                $("#personelDetayModal").modal('show');
            },
            error: function (err) {

                swal("Bilgi! ", err.status + "-" + err.statusText, "success");
            }
        });
    }

    function PersonelDetayCardPartial(personelId) {
        $.ajax({
            url: '/Home/PersonelDetayCardPartial',
            data: {
                id: personelId
            },
            type: 'GET',
            success: function (response) {
                $('#divPartial').html(response);
                $("#personelDetayCard").modal('show');
            },
            error: function (err) {

                swal("Bilgi! ", err.status + "-" + err.statusText, "success");
            }
        });
    }


    function PersonelSil(personelId) {
        $.ajax({
            url: '/Home/PersonelSil',
            data: {
                id: personelId
            },
            type: 'GET',
            success: function (result) {
                swal("Bilgi! ", result.message, "success");
                PersonelleriListele();
            },
            error: function (err) {

                swal("Bilgi! ", result.message, "error");
            }
        });
    }



    function PersonelListesiniIndır() {
        window.open("/Home/ExportDynamicExcelBlogList");
    }



    

</script>

<script>
    //Eski yöntem ile verileri tablo görünümünde listeleme. Yeni revize edilmiş projede bir tane partialview oluşturup onun üzerinden verileri getiriyoruz.

    //$("#btngetlistfilter").click(function () {

    //    let filtreler = {
    //        q: $("#personeladi").val(),
    //        gendernumber: $("input[name='gendernumber']:checked").val(),
    //        maritalnumber: $("input[name='maritalnumber']:checked").val(),
    //        sehir: $('#sehir2').val(),
    //    };

    //    $.ajax({
    //        contentType: "application/json",
    //        dataType: "json",
    //        type: "Get",
    //        url: "/Home/AjaxileFiltrelenVeriGetirme",
    //        data: filtreler,
    //        success: function (func) {
    //            let w = jQuery.parseJSON(func);
    //            console.log(w);
    //            let tablehtml = "<table class=table table-bordered> <tr> <th>#</th> <th>İsim</th>  <th>Soyisim</th>  <th>Tc</th>  <th>Baba Adı</th> <th>Anne Adı</th> <th>Cinsiyet</th> <th>Medeni Hal</th> <th>Doğum Yeri</th>  <th>Güncelleme</th> <th>Sime</th>  <th>Ayrıntı</th> </tr>";
    //            $.each(w, (index, value) => {

    //                /**/
    //                /**/
    //                tablehtml += `<tr><td>${value.Id}</td> <td>${value.Adi}</td> <td>${value.Soyadi}</td> <td>${value.TcNo}</td> <td>${value.BabaAdi}</td> <td>${value.AnaAdi}</td> <td>${value.GenderName}</td> <td>${value.MaritalStatusName}</td> <td>${value.CityName}</td> <td>${value.Adi}</td>   <td><a class="btn btn-primary" href="/Home/PersonelEkle/${value.Id}">Güncelle</a></td>  <td><button type="button" class="btn btn-info editAccount" id="${value.Id}">Personel Sil</button></td> <td><a class="btn btn-danger" href="/Home/Index">Ayrıntı</a></td> </tr>`
    //                /**/
    //                /**/
    //            });
    //            tablehtml += "</table>";
    //            $("#writerlist2").html(tablehtml);
    //        }
    //    });

    //});




    //Aşağıdaki kodlarda işi uzattım o yüzden kullanılmayacak. Sebebi ise ilk önce bir actiona gidip filtreleme yapıyorum sonrada o filtreden gelen veriyi partial olarak kullandığım actiona gönderip oradan kodu kullanıyorum.
    //$("#button1").click(function () {
    //    let filtreler = {
    //        q: $("#personeladi").val(),
    //        gendernumber: $("input[name='gendernumber']:checked").val(),
    //        maritalnumber: $("input[name='maritalnumber']:checked").val(),
    //        sehir: $('#sehir2').val(),
    //    };

    //    $.ajax({
    //        contentType: "application/json",
    //        dataType: "json",
    //        type: "Get",
    //        url: "/Home/AjaxileFiltrelenVeriGetirme",
    //        data: filtreler,
    //        success: function (func) {
    //            let w = jQuery.parseJSON(func);
    //            console.log(w);
    //            $("#div1").load("/Home/PersonelListesiPartial", { personel: w });
    //        }
    //    });
    //    /*        $("#div1").load("/Home/PersonelListesiPartial");*/
    //});



    //$("#btnaddwriter").click(function () {
    //    let writer = {
    //        Id: $("#Id").val(),
    //        Adi: $("#Adi").val(),
    //        Soyadi: $("#Soyadi").val(),
    //        TcNo: $("#TcNo").val(),
    //        BabaAdi: $("#BabaAdi").val(),
    //        AnaAdi: $("#AnaAdi").val(),
    //        GenderId: $("#GenderId").val(),
    //        CityId: $("#CityId").val(),
    //        MaritalStatusId: $("#MaritalStatusId").val(),
    //    };

    //    $.ajax({
    //        type: "post",
    //        url: "/Home/PersonelEkle",
    //        data: writer,
    //        success: function (func) {
    //            let gelenmesaj = jQuery.parseJSON(func);
    //            swal("Tebrikler! ", gelenmesaj, "success");
    //            $("#btngetlistfilter").click();
    //            $("#editEmpModal").modal('hide');
    //        },
    //        error: function (sonucMesaji) {
    //            swal("Hata! ", "Lütfen Tüm Alanları Doldurunuz", "error");
    //        }
    //    });
    //});









    //$(document).on('click', '.addAccount', function () {
    //    let filtreler = {
    //        id: $(this).attr('id'),
    //    };
    //    $("#eklemeguncellemepopup").load("/Home/AjaxileVeriEkleme", filtreler);
    //    $("#editEmpModal").modal('show');
    //});
</script>