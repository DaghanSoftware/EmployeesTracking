@model EmployeesTracking.Models.PersonelViewModel
@{
    ViewData["Title"] = "PersonelListele";
}

@if (TempData["Message"] != null)
{
    @section message
            {
        @await Html.PartialAsync("_message", (string)TempData["Message"])
    }
}

<!doctype html>
<html>

<head>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>
<body>

    <div class="row">
        <div class="col-md-2">

            <div class="modal-dialog">
                <div class="modal-content">
                    <div style="text-align:center">
                        <button type="button" class="btn btn-info addAccount" id="deneme">Personel Ekle</button>
                    </div>

                    <div class="modal-header">
                        <h3 class="modal-title">Kriterlere Göre Filtreleme</h3>
                    </div>

                    <form asp-controller="Home" asp-action="Index" method="get">
                        <center>

                            <input class="form-control me-2" id="personeladi" name="q" type="text" placeholder="Personel Ara" aria-label="Ara">
                            <br />
                            <select asp-items="@ViewBag.Cities" id="sehir2" name="sehir" class="form-control">
                                <option selected disabled>Şehir Seçiniz</option>

                            </select>
                            <br />
                            <div class="btn-group" role="group" aria-label="Basic radio toggle button group">
                                <input type="radio" class="btn-check" name="gendernumber" id="btnradio1" value="1" autocomplete="off">
                                <label class="btn btn-outline-primary" for="btnradio1">Erkek</label>

                                <input type="radio" class="btn-check" name="gendernumber" id="btnradio2" value="2" autocomplete="off">
                                <label class="btn btn-outline-primary" for="btnradio2">Kadın</label>
                            </div>
                            <br />
                            <hr />

                            <input type="radio" class="btn-check" name="maritalnumber" id="vbtn-radio1" value="1" autocomplete="off">
                            <label class="btn btn-outline-danger" for="vbtn-radio1">Evli</label>

                            <input type="radio" class="btn-check" name="maritalnumber" id="vbtn-radio2" value="2" autocomplete="off">
                            <label class="btn btn-outline-danger" for="vbtn-radio2">Bekar</label>
                            <br />



                            <div class="modal-footer">
                                <div style="text-align:center">
                                    <button type="button" id="btngetlistfilter" class="btn btn-outline-primary"> Filterlenen Personeli Getirme Listesi </button>
                                </div>

                            </div>
                        </center>
                    </form>
                </div>
            </div>
        </div>
        <div class="col-md-10">
            <center><h4>Personeller</h4></center>
            <div id="writerlist2">
                Daha Önce Personel Eklenmemiştir.
            </div>
        </div>
    </div>

    <div class="modal fade" id="editEmpModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <form style="padding:40px 50px;" class="row g-3">
                    <div asp-validation-summary="All" id="hatalar"> </div>
                    <input type="hidden" asp-for="Id" class="form-control">
                    <div class="col-md-6">
                        <label asp-for="Adi" class="form-label">İsim</label>
                        <input asp-for="Adi" class="form-control">
                        <span asp-validation-for="Adi" class="text-danger"></span>
                    </div>
                    <div class="col-md-6">
                        <label asp-for="Soyadi" class="form-label">Soyisim</label>
                        <input asp-for="Soyadi" class="form-control">
                        <span asp-validation-for="Soyadi" class="text-danger"></span>
                    </div>
                    <div class="col-md-6">
                        <label asp-for="TcNo" class="form-label">Tc Kimlik Numarası</label>
                        <input asp-for="TcNo" maxlength="11" class="form-control">
                        <span asp-validation-for="TcNo" class="text-danger"></span>
                    </div>
                    <div class="col-md-6">
                        <label asp-for="BabaAdi" class="form-label">Baba Adı</label>
                        <input asp-for="BabaAdi" class="form-control">
                        <span asp-validation-for="BabaAdi" class="text-danger"></span>
                    </div>
                    <div class="col-md-6">
                        <label asp-for="AnaAdi" class="form-label">Anne Adı</label>
                        <input asp-for="AnaAdi" class="form-control">
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Erkek</label>
                            <input type="radio" value="1" asp-for="GenderId" />
                            <br />
                            <label>Kadın</label>
                            <input type="radio" value="2" asp-for="GenderId" />
                            <span asp-validation-for="GenderId" class="text-danger"></span>
                        </div>
                    </div>
                    @*<div class="col-md-6">
                            <label asp-for="MedeniHali" class="form-label">Medeni Hali</label>
                            <input asp-for="MedeniHali" class="form-control">
                            <span asp-validation-for="MedeniHali" class="text-danger"></span>
                        </div>*@

                    <div class="col-md-6">
                        <div class="form-group">
                            <label asp="Doğum Yeri">Doğum Yeri</label>
                            <select asp-for="CityId" asp-items="@ViewBag.Cities" class="form-control">
                                <option selected disabled>Şehir Seçiniz</option>

                            </select>
                            <span asp-validation-for="CityId" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Evli</label>
                            <input type="radio" value="1" asp-for="MaritalStatusId" />
                            <br />
                            <label>Bekar</label>
                            <input type="radio" value="2" asp-for="MaritalStatusId" />
                            <span asp-validation-for="MaritalStatusId" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="col-12">
                        <button type="button" id="btnaddwriter" class="btn btn-success"> Personel Ekle  </button>
                        @*<center><button type="submit" class="btn btn-primary">@( Model.Id>0 ? "Personel Güncelle":"Personel Ekle")</button></center>*@
                    </div>
                </form>

            </div>
        </div>
    </div>

</body>
</html>



<script>
    $(document).ready(function () {
        $("#btngetlistfilter").click();

        $("#divPersoneller").load("asdfadsf");
    });

    $("#btngetlistfilter").click(function () {

        let filtreler = {
            q: $("#personeladi").val(),
            gendernumber: $("input[name='gendernumber']:checked").val(),
            maritalnumber: $("input[name='maritalnumber']:checked").val(),
            sehir: $('#sehir2').val(),
        };

        $.ajax({
            contentType: "application/json",
            dataType: "json",
            type: "Get",
            url: "/Deneme/AjaxileFiltrelenVeriGetirme",
            data: filtreler,
            success: function (func) {
                let w = jQuery.parseJSON(func);
                console.log(w);
                let tablehtml = "<table class=table table-bordered> <tr> <th>#</th> <th>İsim</th>  <th>Soyisim</th>  <th>Tc</th>  <th>Baba Adı</th> <th>Anne Adı</th> <th>Cinsiyet</th> <th>Medeni Hal</th> <th>Doğum Yeri</th>  <th>Güncelleme</th> <th>Sime</th>  <th>Ayrıntı</th> </tr>";
                $.each(w, (index, value) => {

                    /**/
                    /**/
                    tablehtml += `<tr><td>${value.Id}</td> <td>${value.Adi}</td> <td>${value.Soyadi}</td> <td>${value.TcNo}</td> <td>${value.BabaAdi}</td> <td>${value.AnaAdi}</td> <td>${value.GenderName}</td> <td>${value.MaritalStatusName}</td> <td>${value.CityName}</td> <td>${value.Adi}</td>   <td><a class="btn btn-primary" href="/Home/PersonelEkle/${value.Id}">Güncelle</a></td>  <td><button type="button" class="btn btn-info editAccount" id="${value.Id}">Personel Sil</button></td> <td><a class="btn btn-danger" href="/Home/Index">Ayrıntı</a></td> </tr>`
                    /**/
                    /**/
                });
                tablehtml += "</table>";
                $("#writerlist2").html(tablehtml);
            }
        });

    });


    $(document).on('click', '.editAccount', function () {
        let filtreler = {
            id: $(this).attr('id'),
        };
        $.ajax({
            contentType: "application/json",
            dataType: "json",
            type: "Get",
            url: "/Deneme/AjaxileVeriSilme/",
            data: filtreler,
            success: function (func) {
                let result = jQuery.parseJSON(func);
                $("#btngetlistfilter").click();
                swal("Tebrikler! ", "Silme İşlemi Başarıyla Gerçekleşti", "success");

            }
        });

    });


    $(document).on('click', '.addAccount', function () {
        $.ajax({
            type: "POST",
            success: function (data) {
                $("#editEmpModal").modal('show');
            }
        });

    });


    $("#btnaddwriter").click(function () {
        let writer = {
            Id: $("#Id").val(),
            Adi: $("#Adi").val(),
            Soyadi: $("#Soyadi").val(),
            TcNo: $("#TcNo").val(),
            BabaAdi: $("#BabaAdi").val(),
            AnaAdi: $("#AnaAdi").val(),
            GenderId: $("#GenderId").val(),
            CityId: $("#CityId").val(),
            MaritalStatusId: $("#MaritalStatusId").val(),
        };

        $.ajax({
            type: "post",
            url: "/Home/PersonelEkle",
            data: writer,
            success: function (func) {
                let gelenmesaj = jQuery.parseJSON(func);
                swal("Tebrikler! ", gelenmesaj, "success");
                $("#btngetlistfilter").click();
                $("#editEmpModal").modal('hide');
            },
            error: function (sonucMesaji) {
                swal("Hata! ", "Lütfen Tüm Alanları Doldurunuz", "error");
            }
        });
    });


</script>